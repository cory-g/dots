#!/bin/sh

echo "Please wait"

INPUT_IMAGE=$1
TMP_IMAGE=tmp.png
COLOR_RAW=$(xgetres color0)
HEX=${COLOR_RAW#?}
RGB=$(printf "%d,%d,%d\n" 0x${HEX:0:2} 0x${HEX:2:2} 0x${HEX:4:2})

filename=$(basename -- "$INPUT_IMAGE")
extension="${filename##*.}"
filename="${filename%.*}"

WIDTH=$(identify -format "%w" $INPUT_IMAGE)
HEIGHT=$(identify -format "%h" $INPUT_IMAGE)

convert -size $WIDTH'x'$HEIGHT xc:rgba\($RGB,0.7\) $TMP_IMAGE

magick composite -gravity center $TMP_IMAGE $INPUT_IMAGE './'$filename'_sub.png'
rm $TMP_IMAGE
