#!/bin/sh
#
# dotz - 0.0.1 - April  9, 2019 @ 12:20 pm
# created: April  9, 2019 @ 12:20 pm by Cory G
# license: gpl-2.0
#
#       ██            ██
#      ░██           ░██
#      ░██  ██████  ██████ ██████
#   ██████ ██░░░░██░░░██░ ░░░░██
#  ██░░░██░██   ░██  ░██     ██
# ░██  ░██░██   ░██  ░██    ██
# ░░██████░░██████   ░░██  ██████
#  ░░░░░░  ░░░░░░     ░░  ░░░░░░
#
# *******************************
# Script to automatically commit and push changes in my dotfiles repo
# ------------------------------------------
#
# contact
# -------
# << cory.gantenbein@protonmail.com >> || << https://coryg.me >>

GIT=$(which git)
TOILET=$(which toilet)

THE_DATE=`date '+%B %e, %Y @ %l:%M %P'`

if [[ -z $1 ]]; then
  COMMIT_MSG="Automated commit on ${THE_DATE}"
else
  COMMIT_MSG=$1
fi

# Update package list in docs
$TOILET -f Chunky "apps" | lolcat
echo ""
echo "# Packages" > $HOME/.dotfiles/doc/apps.tmp.md
echo "\`Result of pacman -Qet\`" >> $HOME/.dotfiles/doc/apps.tmp.md
echo "" >> $HOME/.dotfiles/doc/apps.tmp.md
pacman -Qet >> ./apps.tmp.txt
sed -e 's/^/- /' ./apps.tmp.txt > ./apps.txt
rm ./apps.tmp.txt
cat $HOME/.dotfiles/doc/apps.tmp.md ./apps.txt > $HOME/.dotfiles/doc/apps.md
rm ./apps.txt
rm $HOME/.dotfiles/doc/apps.tmp.md

# status
$TOILET -f Chunky "status" | lolcat
echo ""
$GIT --git-dir=$HOME/.dotfiles/.git --work-tree=$HOME/.dotfiles status

# add all
$GIT --git-dir=$HOME/.dotfiles/.git --work-tree=$HOME/.dotfiles add .

# status again
echo ""
$TOILET -f Chunky "status" | lolcat
$GIT --git-dir=$HOME/.dotfiles/.git --work-tree=$HOME/.dotfiles status

# commit
echo ""
$TOILET -f Chunky "commit" | lolcat
echo "Committing with message '${COMMIT_MSG}'"
$GIT --git-dir=$HOME/.dotfiles/.git --work-tree=$HOME/.dotfiles commit -m "${COMMIT_MSG}"

# push
echo ""
$TOILET -f Chunky "push" | lolcat
$GIT --git-dir=$HOME/.dotfiles/.git --work-tree=$HOME/.dotfiles push
